# Markdown/MDX 文案渲染整体方案

目标：将所有文案从 JSON 渲染切换为 Markdown/MDX 渲染，统一内容来源与渲染入口，并支持目录与地图联动。

## 范围与目标

- 文案主体：从 JSON 结构化内容迁移为 Markdown/MDX 内容文件。
- 目录体系：阅读站点需要章节目录与前后章导航。
- 地图联动：文案中的点可驱动地图高亮与聚焦。
- 动态路径：章节之间的起止地点驱动路径渲染。
- 元数据：保留标题、作者、章节序等必要字段（frontmatter 或目录索引）。

## 整体方案

- 内容源统一：使用 `.md` / `.mdx` 承载文案主体。
- 数据访问改造：新增内容加载层，按 `slug/id` 读取 Markdown/MDX 与元信息。
- 渲染入口统一：抽象 `MdxRenderer` 组件，支持地图与目录联动。
- 内容结构约定：frontmatter 承载目录、地图点、起止地点等元信息。
- 目录系统：由 Markdown/MDX 元信息生成目录与前后章导航。
- 路径计算：基于上一章结束点与下一章起始点动态生成路线。
- 迁移策略：一次性迁移并移除 JSON。

## 具体步骤（建议顺序）

1. 定义 Markdown/MDX 规范  
   - 文件扩展名、目录结构  
   - frontmatter 字段（`title`, `chapter`, `order`, `toc`, `points`, `start`, `end`）
2. 实现内容加载层  
   - `getMdxContent(id)`：读取 Markdown/MDX 主体  
   - `getMdxMeta(id)`：读取元数据  
   - 目录索引：根据 `order` 与 `toc` 生成目录
3. 抽象渲染与联动入口  
   - `WdxRenderer` 组件统一渲染  
   - 暴露地图联动 API（高亮点、聚焦点、展示路径）
4. 目录与章节导航  
   - 目录页与章节内目录渲染  
   - 上一章/下一章导航与路由
5. 动态路径逻辑  
   - 读取上一章 `end` 与下一章 `start`  
   - 生成并渲染路线（与地图联动）
6. 迁移与清理  
   - 一次性脚本：JSON → WDX  
   - 对照校验内容一致性  
   - 移除 JSON 读取、解析逻辑与相关类型

## 风险与处理

- 性能：WDX 可 build-time 预编译并缓存。
- 格式错误：引入校验脚本或 CI 规则。
- 地图联动：联动 API 需要有降级策略（无点时不渲染）。

## 需要确认的关键点

- WDX 是否需要支持自定义组件？范围到哪种？
- 地图点/路线数据由谁提供与维护？是否需要编辑工具？
- 渲染是完全静态构建，还是需要运行时解析？

